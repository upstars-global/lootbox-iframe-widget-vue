<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üé∞ Lootbox Widget</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1.2fr 1fr 1.2fr;
        gap: 20px;
      }

      .controls {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        height: fit-content;
      }

      .widget-section {
        display: flex;
        padding: 20px;
        flex-direction: column;
        justify-content: start;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .control-group {
        margin-bottom: 20px;
      }

      .control-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
      }

      .control-group.active-checkbox .label-container {
        display: flex;
        align-items: start;
        gap: 8px;
      }

      .control-group.active-checkbox .label-container input {
        width: auto;
      }

      h2,
      h3 {
        font-size: 1.5em;
        margin: 0 0 20px 0;
        color: #333;
      }

      .control-group input,
      .control-group select,
      .control-group textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }

      .control-group textarea {
        height: 100px;
        min-height: 100px;
        resize: vertical;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        border: 1px solid #e9ecef;
        box-sizing: border-box;
      }

      .control-group textarea[id='sectors'],
      .control-group textarea[id='sectorsType'] {
        height: 60px;
        min-height: 60px;
      }

      .label-container {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 5px;
      }

      .url-display {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        word-break: break-all;
        border: 1px solid #e9ecef;
        height: 100px;
        min-height: 100px;
        overflow-y: auto;
        box-sizing: border-box;
      }

      .copy-btn {
        background: none;
        color: #007bff;
        border: none;
        cursor: pointer;
        font-size: 16px;
        transition: color 0.2s;
        padding: 2px;
        border-radius: 3px;
      }

      .copy-btn:hover {
        color: #0056b3;
        background: #f8f9fa;
      }

      .copy-btn:active {
        color: #004085;
      }

      .theme-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .theme-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .theme-btn.default {
        background: #007bff;
        color: white;
      }

      .theme-btn.crown {
        background: #ffc107;
        color: #333;
      }

      .theme-btn:hover {
        opacity: 0.8;
      }

      .theme-btn.active {
        box-shadow: 0 0 0 2px #333;
      }

      .iframe-wrapper {
        width: 100%;
        height: 470px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        background: #fafafa;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 8px;
      }

      .log-section {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        display: flex;
        flex-direction: column;
      }

      .log-header {
        margin: 10px 0 20px;
      }

      .log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        flex: 1;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }

      .log-entry {
        margin: 5px 0;
        padding: 5px;
        border-radius: 3px;
        border-left: 3px solid transparent;
        font-weight: 500;
      }

      .log-received {
        background: #d4edda;
        color: #155724;
        border-left-color: #28a745;
      }

      .log-sent {
        background: #cce5ff;
        color: #004085;
        border-left-color: #007bff;
      }

      .log-error {
        background: #f8d7da;
        color: #721c24;
        border-left-color: #dc3545;
      }

      .log-info {
        background: #d1ecf1;
        color: #0c5460;
        border-left-color: #17a2b8;
      }

      .action-buttons {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin: 10px 0;
      }

      .btn {
        width: 50%;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #545b62;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #1e7e34;
      }

      .btn:disabled {
        opacity: 0.8;
        cursor: not-allowed;
        pointer-events: none;
      }

      .winning-sector-control {
        margin: 15px 0;
      }

      .winning-sector-control label {
        display: block;
        margin-bottom: 5px;
      }

      .winning-sector-control select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }

      .apply-custom-url-btn {
        margin-top: 10px;
        width: 100%;
      }

      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-size: 14px;
      }

      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="controls">
        <div class="status info">
          <strong>üí° –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</strong> –ó–º—ñ–Ω—é–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ - –≤–∏–¥–∂–µ—Ç
          –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –ö–Ω–æ–ø–∫–∞ "–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–ø—ñ–Ω" –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î
          –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ iframe.
        </div>

        <h2>üéõÔ∏è –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</h2>
        <div class="control-group">
          <label>–¢–µ–º–∞:</label>
          <div class="theme-buttons">
            <button class="theme-btn default active" onclick="setTheme(1)">
              Default (1)
            </button>
            <button class="theme-btn crown" onclick="setTheme(2)">
              Crown (2)
            </button>
          </div>
        </div>

        <div class="control-group">
          <label for="sectors">–°–µ–∫—Ç–æ—Ä–∏ (—á–µ—Ä–µ–∑ –∫–æ–º—É):</label>
          <textarea
            id="sectors"
            placeholder="500 USD, 5000 USD, 10 FS, 20 FS, 35 FS, 25 USD, 100 USD, 250 USD"
          >
500 USD, 5000 USD, 10 FS, 20 FS, 35 FS, 25 USD, 100 USD, 250 USD</textarea
          >
        </div>

        <div class="control-group">
          <label for="sectorsType">–¢–∏–ø–∏ —Å–µ–∫—Ç–æ—Ä—ñ–≤ (—á–µ—Ä–µ–∑ –∫–æ–º—É):</label>
          <textarea
            id="sectorsType"
            placeholder="Bonus Prize, Bonus Prize, Free Spins, Free Spins, Free Spins, Bonus Prize, Bonus Prize, Bonus Prize"
          >
Bonus Prize, Bonus Prize, Free Spins, Free Spins, Free Spins, Bonus Prize, Bonus Prize, Bonus Prize</textarea
          >
        </div>

        <div class="control-group active-checkbox">
          <label class="label-container">
            <input
              type="checkbox"
              id="activeCheckbox"
              checked
              style="display: inline-block"
            />
            –ê–∫—Ç–∏–≤–Ω–∏–π –ª—É—Ç–±–æ–∫—Å (–∞–Ω–∏–º–∞—Ü—ñ—ó –≤–∫–ª—é—á–µ–Ω—ñ)
          </label>
        </div>

        <div class="control-group">
          <div class="label-container">
            <label>URL –≤–∏–¥–∂–µ—Ç–∞ (–ø—Ä–∏–∫–ª–∞–¥):</label>
            <button
              class="copy-btn"
              onclick="copyWidgetUrl()"
              title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL"
            >
              üìÑ
            </button>
          </div>
          <div class="url-display" id="widgetUrl"></div>
        </div>

        <!-- –î–æ–¥–∞—î–º–æ –ø–æ–ª–µ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ URL –Ω–∞ –ø–µ—Ä—à—É –≤–∫–ª–∞–¥–∫—É -->
        <div class="control-group">
          <label for="customUrl">URL –≤–∏–¥–∂–µ—Ç–∞:</label>
          <textarea id="customUrl" placeholder="–í—Å—Ç–∞–≤—Ç–µ URL —Å—é–¥–∞..."></textarea>
          <button
            class="btn btn-primary apply-custom-url-btn"
            onclick="applyCustomUrl()"
          >
            –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –∫–∞—Å—Ç–æ–º–Ω–∏–π URL
          </button>
        </div>
      </div>

      <div class="widget-section">
        <div class="action-buttons">
          <button
            class="btn btn-success"
            id="startSpinBtn"
            onclick="startSpin()"
          >
            ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–ø—ñ–Ω
          </button>

          <button
            class="btn btn-primary"
            id="setWinningSectorBtn"
            onclick="setWinningSector()"
          >
            üéØ –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–∏–≥—Ä–∞—à–Ω–∏–π —Å–µ–∫—Ç–æ—Ä
          </button>
        </div>

        <div class="winning-sector-control">
          <label for="winningSector">üéØ –í–∏–≥—Ä–∞—à–Ω–∏–π —Å–µ–∫—Ç–æ—Ä:</label>
          <select id="winningSector">
            <option value="0">–°–µ–∫—Ç–æ—Ä 0</option>
            <option value="1">–°–µ–∫—Ç–æ—Ä 1</option>
            <option value="2">–°–µ–∫—Ç–æ—Ä 2</option>
            <option value="3">–°–µ–∫—Ç–æ—Ä 3</option>
            <option value="4">–°–µ–∫—Ç–æ—Ä 4</option>
            <option value="5">–°–µ–∫—Ç–æ—Ä 5</option>
            <option value="6">–°–µ–∫—Ç–æ—Ä 6</option>
            <option value="7">–°–µ–∫—Ç–æ—Ä 7</option>
          </select>
        </div>

        <div class="iframe-wrapper">
          <iframe id="widgetFrame" src=""></iframe>
        </div>
      </div>

      <div class="log-section">
        <div class="log-header">
          <h3>üìã –õ–æ–≥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</h3>
          <button class="btn btn-secondary" onclick="clearLog()">
            üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥
          </button>
        </div>
        <div class="log" id="messageLog"></div>
      </div>
    </div>

    <script>
      // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
      let currentParams = {
        style: 1,
        sectors:
          '500 USD, 5000 USD, 10 FS, 20 FS, 35 FS, 25 USD, 100 USD, 250 USD',
        sectors_type:
          'Bonus Prize, Bonus Prize, Free Spins, Free Spins, Free Spins, Bonus Prize, Bonus Prize, Bonus Prize',
        active: true, // –ø–∞—Ä–∞–º–µ—Ç—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ª—É—Ç–±–æ–∫—Å–∞
      }

      let widgetReady = false
      let isSpinning = false
      let iframe = document.getElementById('widgetFrame')
      const messageLog = document.getElementById('messageLog')
      const startSpinBtn = document.getElementById('startSpinBtn')
      const setWinningSectorBtn = document.getElementById('setWinningSectorBtn')

      // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º –∫–Ω–æ–ø–æ–∫
      function disableStartButton() {
        startSpinBtn.disabled = true
        isSpinning = true
      }

      function disableSectorButton() {
        setWinningSectorBtn.disabled = true
      }

      function enableButtons() {
        startSpinBtn.disabled = false
        setWinningSectorBtn.disabled = false
        isSpinning = false
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ª—É—Ç–±–æ–∫—Å–∞
      function updateButtonsState() {
        const isActive = currentParams.active
        const winningSectorSelect = document.getElementById('winningSector')

        startSpinBtn.disabled = !isActive || !widgetReady || isSpinning
        setWinningSectorBtn.disabled = !isActive || !isSpinning
        winningSectorSelect.disabled = !isActive
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–µ–º–∏
      function setTheme(themeIndex) {
        currentParams.style = themeIndex

        // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω—É –∫–Ω–æ–ø–∫—É
        document
          .querySelectorAll('.theme-btn')
          .forEach(btn => btn.classList.remove('active'))
        if (themeIndex === 1) {
          document.querySelector('.theme-btn.default').classList.add('active')
        } else {
          document.querySelector('.theme-btn.crown').classList.add('active')
        }

        updateWidget()
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ URL
      function applyCustomUrl() {
        const textarea = document.getElementById('customUrl')
        let customUrl = textarea ? textarea.value.trim() : ''

        if (customUrl) {
          try {
            // –í–∏–ø—Ä–∞–≤–ª—è—î–º–æ —Å–∏–º–≤–æ–ª—ã ¬ß –Ω–∞ &
            customUrl = customUrl.replace(/¬ß/g, '&')

            // –ü–∞—Ä—Å–∏–º–æ URL —Ç–∞ –æ–Ω–æ–≤–ª—é—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
            const url = new URL(customUrl)

            // –û–Ω–æ–≤–ª—é—î–º–æ currentParams –∑ URL
            currentParams.style = parseInt(url.searchParams.get('style')) || 1
            currentParams.sectors = url.searchParams.get('sectors') || ''
            currentParams.sectors_type =
              url.searchParams.get('sectors_type') || ''
            currentParams.active = url.searchParams.get('active') !== 'false' // true –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

            // –í–∏–ø—Ä–∞–≤–ª—è—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ –≤ —Å–µ–∫—Ç–æ—Ä–∞—Ö
            if (currentParams.sectors) {
              currentParams.sectors = currentParams.sectors.replace(/,/g, ', ')
            }
            if (currentParams.sectors_type) {
              currentParams.sectors_type = currentParams.sectors_type.replace(
                /,/g,
                ', '
              )
            }

            // –û–Ω–æ–≤–ª—é—î–º–æ —Ñ–æ—Ä–º—É
            updateFormFields()

            // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω—É —Ç–µ–º—É
            document
              .querySelectorAll('.theme-btn')
              .forEach(btn => btn.classList.remove('active'))
            if (currentParams.style === 1) {
              document
                .querySelector('.theme-btn.default')
                .classList.add('active')
            } else {
              document.querySelector('.theme-btn.crown').classList.add('active')
            }

            // –°–∫–∏–¥–∞—î–º–æ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –≤–∏–¥–∂–µ—Ç–∞
            widgetReady = false

            // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–¥–∂–µ—Ç
            updateWidget()
          } catch (error) {
            logMessage(
              '‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É URL: ' + error.message,
              'error',
              'PARENT'
            )
          }
        } else {
          logMessage('‚ùå –ü–æ—Ä–æ–∂–Ω—ñ–π URL', 'error', 'PARENT')
        }
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏
      function updateFormFields() {
        document.getElementById('sectors').value = currentParams.sectors || ''
        document.getElementById('sectorsType').value =
          currentParams.sectors_type || ''
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–¥–∂–µ—Ç–∞
      function updateWidget() {
        const url = new URL('http://localhost:5173/')

        // –î–æ–¥–∞—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
        Object.entries(currentParams).forEach(([key, value]) => {
          if (value !== undefined && value !== null && value !== '') {
            url.searchParams.set(key, value)
          }
        })

        const finalUrl = url.toString()

        // –û–Ω–æ–≤–ª—é—î–º–æ URL —Ç–∞ iframe
        document.getElementById('widgetUrl').textContent = finalUrl
        iframe.src = finalUrl
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∑ input –ø–æ–ª—ñ–≤
      function updateParams() {
        currentParams.sectors = document.getElementById('sectors').value
        currentParams.sectors_type =
          document.getElementById('sectorsType').value
        currentParams.active = document.getElementById('activeCheckbox').checked

        updateWidget()
        updateButtonsState()
      }

      // –°–ª—É—Ö–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –≤–∏–¥–∂–µ—Ç–∞
      window.addEventListener('message', event => {
        if (!event.data || typeof event.data !== 'object') return

        switch (event.data.type) {
          case 'lootboxReady':
            widgetReady = true
            logMessage('üì§ lootboxReady', 'received', 'WIDGET')
            updateButtonsState()
            break
          case 'winSector':
            logMessage(
              `üì§ winSector: ${event.data.data.sector}`,
              'received',
              'WIDGET'
            )
            break
          case 'spinEnd':
            logMessage(
              `üì§ spinEnd: ${event.data.data.prize}`,
              'received',
              'WIDGET'
            )
            enableButtons()
            updateButtonsState()
            break
        }
      })

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø—É—Å–∫—É —Å–ø—ñ–Ω–∞
      function startSpin() {
        if (!widgetReady) {
          logMessage('‚ùå –í–∏–¥–∂–µ—Ç —â–µ –Ω–µ –≥–æ—Ç–æ–≤–∏–π', 'error', 'PARENT')
          return
        }

        if (isSpinning) {
          return
        }

        disableStartButton()
        updateButtonsState()
        const message = { type: 'startSpin' }
        iframe.contentWindow.postMessage(message, '*')
        logMessage('üì• startSpin', 'sent', 'PARENT')
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–≥–∞—à–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞
      function setWinningSector() {
        if (!isSpinning) {
          return
        }

        const select = document.getElementById('winningSector')
        const selectedValue = select.value

        const winningSector = parseInt(selectedValue)
        const sectors = currentParams.sectors.split(', ')
        const sectorName =
          sectors[winningSector] || `–°–µ–∫—Ç–æ—Ä ${winningSector + 1}`

        // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ iframe
        const message = {
          type: 'winSector',
          data: winningSector,
        }

        iframe.contentWindow.postMessage(message, '*')
        logMessage(`üì• winSector: ${winningSector}`, 'sent', 'PARENT')

        // –ë–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ–∫—Ç–æ—Ä–∞
        disableSectorButton()
        updateButtonsState()
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
      function logMessage(message, type = 'info', sender = '') {
        const entry = document.createElement('div')
        entry.className = `log-entry log-${type}`
        const senderPrefix = sender ? `[${sender}] ` : ''
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${senderPrefix}${message}`
        messageLog.appendChild(entry)
        messageLog.scrollTop = messageLog.scrollHeight
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è URL –≤–∏–¥–∂–µ—Ç–∞
      function copyWidgetUrl() {
        const urlDisplay = document.getElementById('widgetUrl')
        const url = urlDisplay.textContent.trim()

        if (url) {
          navigator.clipboard
            .writeText(url)
            .then(() => {
              // –í—Å—Ç–∞–≤–ª—è–µ–º URL –≤ –ø–æ–ª–µ customUrl
              const customUrlTextarea = document.getElementById('customUrl')
              if (customUrlTextarea) {
                customUrlTextarea.value = url
              }
            })
            .catch(err => {
              logMessage(
                '‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è: ' + err.message,
                'error',
                'PARENT'
              )
            })
        } else {
          logMessage('‚ùå URL –ø–æ—Ä–æ–∂–Ω—ñ–π', 'error', 'PARENT')
        }
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –ª–æ–≥—É
      function clearLog() {
        messageLog.innerHTML = ''
      }

      // –î–æ–¥–∞—î–º–æ event listeners –¥–ª—è –≤—Å—ñ—Ö input –ø–æ–ª—ñ–≤
      document.getElementById('sectors').addEventListener('input', updateParams)
      document
        .getElementById('sectorsType')
        .addEventListener('input', updateParams)
      document
        .getElementById('activeCheckbox')
        .addEventListener('change', updateParams)

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –≤–∏–¥–∂–µ—Ç
      updateWidget()
      updateButtonsState()
    </script>
  </body>
</html>
