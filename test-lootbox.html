<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üé∞ Lootbox Widget</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
      }

      .controls {
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        height: fit-content;
      }

      .widget-section {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 24px;
        display: flex;
        flex-direction: column;
      }

      .widget-controls {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 16px;
      }

      .widget-controls .control-group {
        margin-bottom: 0;
      }

      .widget-controls .action-buttons {
        margin: 0;
      }

      .control-group {
        margin-bottom: 16px;
      }

      .control-group:last-child {
        margin-bottom: 0;
      }

      .control-group label,
      .control-group .label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
      }

      .control-group.checkbox .label-container {
        display: flex;
        align-items: start;
        gap: 8px;
      }

      .control-group.checkbox .label-container input {
        width: auto;
      }

      .theme-select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }

      #winningSector {
        width: auto;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }

      h2,
      h3 {
        font-size: 1.5em;
        margin: 0 0 24px 0;
        color: #333;
      }

      .control-group input:not(.theme-input),
      .control-group select,
      .control-group textarea,
      .control-group .contenteditable-textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }

      .control-group textarea {
        resize: vertical;
        background: white;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        border: 1px solid #e9ecef;
        box-sizing: border-box;
      }

      .control-group .contenteditable-textarea {
        resize: vertical;
        background: white;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        border: 1px solid #e9ecef;
        box-sizing: border-box;
        overflow-y: auto;
        word-break: break-all;
        outline: none;
      }

      .control-group .contenteditable-textarea:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
      }

      .control-group .contenteditable-textarea[data-placeholder]:empty:before {
        content: attr(data-placeholder);
        color: #6c757d;
        font-style: italic;
      }

      .control-group .contenteditable-textarea.spinning {
        background: #f5f5f5;
        color: #999;
        cursor: not-allowed;
      }

      .control-group textarea.spinning {
        background: #f5f5f5;
        color: #999;
        cursor: not-allowed;
      }

      .theme-select.spinning {
        background: #f5f5f5;
        color: #999;
        cursor: not-allowed;
      }

      .label-container {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: bold;
        color: #333;
      }

      .copy-btn {
        background: none;
        color: #007bff;
        border: none;
        cursor: pointer;
        font-size: 16px;
        transition: color 0.2s;
        padding: 2px;
        border-radius: 3px;
      }

      .copy-btn:hover {
        color: #0056b3;
        background: #f8f9fa;
      }

      .copy-btn:active {
        color: #004085;
      }

      .iframe-wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        background: #000a12;
        resize: both;
        overflow: auto;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .log-section {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 24px;
        display: flex;
        flex-direction: column;
      }

      .log {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        flex: 1;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }

      .log-entry {
        margin: 8px 0;
        padding: 8px;
        border-radius: 3px;
        border-left: 3px solid transparent;
        font-weight: 500;
      }

      .log-received {
        background: #d4edda;
        color: #155724;
        border-left-color: #28a745;
      }

      .log-sent {
        background: #cce5ff;
        color: #004085;
        border-left-color: #007bff;
      }

      .log-error {
        background: #f8d7da;
        color: #721c24;
        border-left-color: #dc3545;
      }

      .log-info {
        background: #d1ecf1;
        color: #0c5460;
        border-left-color: #17a2b8;
      }

      .action-buttons {
        display: flex;
        gap: 12px;
        margin: 0 0 16px 0;
        flex-wrap: wrap;
      }

      .btn {
        min-width: 120px;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #545b62;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #1e7e34;
      }

      .btn:disabled {
        opacity: 0.8;
        cursor: not-allowed;
        pointer-events: none;
      }

      .winning-sector-control {
        margin-bottom: 16px;
      }

      .winning-sector-control label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
      }

      .winning-sector-control select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }

      .apply-custom-url-btn {
        margin-top: 16px;
      }

      .status {
        padding: 12px;
        border-radius: 4px;
        margin: 0 0 16px 0;
        font-size: 14px;
      }

      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      @media (max-width: 1024px) {
        .container {
          gap: 15px;
        }

        .controls,
        .widget-section,
        .log-section {
          padding: 15px;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 12px;
        }

        .container {
          display: flex;
          flex-direction: column;
          gap: 16px;
        }

        .controls,
        .widget-section {
          padding: 16px;
        }

        .control-group {
          margin-bottom: 12px;
        }

        .control-group label {
          margin-bottom: 6px;
        }

        h2,
        h3 {
          margin: 0 0 16px 0;
        }

        .action-buttons {
          gap: 8px;
          margin: 12px 0;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="controls">
        <div class="status info">
          <strong>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</strong><br />
          - –û–±—Ä–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ <br />
          - –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ó–∞–ø—É—Å—Ç–∏—Ç–∏" <br />
          - –í–∏–±—Ä–∞—Ç–∏ winSector <br />
          - –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏" <br />
        </div>

        <div class="control-group">
          <label for="projectSelect">–ü—Ä–æ–µ–∫—Ç:</label>
          <select id="projectSelect" class="theme-select">
            <option value="">‚Äî –ë–µ–∑ –ø—Ä–æ–µ–∫—Ç—É ‚Äî</option>
            <option value="rocket">Rocket</option>
            <option value="king">King</option>
            <option value="thor">Thor</option>
          </select>
          <small
            style="
              color: #6c757d;
              font-size: 12px;
              margin-top: 4px;
              display: block;
            "
          >
            ‚ÑπÔ∏è –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ –ø—Ä–æ–µ–∫—Ç ‚Äî –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–µ—Ñ–æ–ª—Ç–Ω—É —Ç–µ–º—É –ø—Ä–æ–µ–∫—Ç—É
            (—è–∫—â–æ —Ç–µ–º–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞ —è–≤–Ω–æ)
          </small>
        </div>

        <div class="control-group">
          <label for="themeSelect">–¢–µ–º–∞:</label>
          <select id="themeSelect" class="theme-select">
            <option value="">‚Äî –î–µ—Ñ–æ–ª—Ç –ø—Ä–æ–µ–∫—Ç—É ‚Äî</option>
            <option value="RocketWheelLite" data-project="rocket">
              RocketWheelLite (Rocket)
            </option>
            <option value="RocketWheelPro" data-project="rocket">
              RocketWheelPro (Rocket)
            </option>
            <option value="KingWheel" data-project="king">
              KingWheel (King)
            </option>
            <option value="ThorWheel" data-project="thor">
              ThorWheel (Thor)
            </option>
          </select>
          <small
            id="themeWarning"
            style="
              color: #dc3545;
              font-size: 12px;
              margin-top: 4px;
              display: none;
            "
          >
            ‚ö†Ô∏è –¢–µ–º–∞ –Ω–µ –Ω–∞–ª–µ–∂–∏—Ç—å –≤–∏–±—Ä–∞–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É ‚Äî –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–µ—Ñ–æ–ª—Ç
          </small>
        </div>

        <div class="control-group">
          <div
            class="contenteditable-textarea"
            id="sectors"
            contenteditable="true"
            data-placeholder="500 USD; 5,000 USD; 10 FS; 20 FS; 35 FS; 25 USD; 100 USD; 250 USD"
          ></div>
        </div>

        <div class="control-group">
          <div
            class="contenteditable-textarea"
            id="sectorsType"
            contenteditable="true"
            data-placeholder="Bonus Prize; Bonus Prize; Free Spins; Free Spins; Free Spins; Bonus Prize; Bonus Prize; Bonus Prize"
          ></div>
        </div>

        <div class="control-group checkbox">
          <label class="label-container">
            <input
              type="checkbox"
              id="activeCheckbox"
              checked
              style="display: inline-block"
            />
            active
          </label>
        </div>

        <div class="control-group checkbox">
          <label class="label-container">
            <input
              type="checkbox"
              id="fpsCheckbox"
              style="display: inline-block"
            />
            fps
          </label>
        </div>

        <div class="control-group">
          <label for="vipLevel">VIP —Ä—ñ–≤–µ–Ω—å (0-‚àû):</label>
          <input type="number" id="vipLevel" min="0" value="0" />
          <small
            style="
              color: #6c757d;
              font-size: 12px;
              margin-top: 4px;
              display: block;
            "
          >
            ‚ÑπÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∏–π –Ω–∞ –º–∞–π–±—É—Ç–Ω—î. –ù–∞—Ä–∞–∑—ñ –Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞
            –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –≤–∏–¥ –∫–æ–ª–µ—Å–∞.
          </small>
        </div>

        <div class="control-group">
          <div class="label">
            URL (example)
            <button
              class="copy-btn"
              onclick="copyWidgetUrl()"
              title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL"
            >
              üìÑ
            </button>
          </div>
          <div class="contenteditable-textarea" id="widgetUrl"></div>
        </div>

        <div class="control-group">
          <div class="label">URL (custom)</div>
          <div
            class="contenteditable-textarea"
            id="customUrl"
            contenteditable="true"
            data-placeholder="–í–≤–µ–¥—ñ—Ç—å URL ./index.html?style=KingWheel&..."
          ></div>
          <button
            class="btn btn-primary apply-custom-url-btn"
            onclick="applyCustomUrl()"
          >
            –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ URL
          </button>
        </div>
      </div>

      <div class="widget-section">
        <div class="widget-controls">
          <div class="action-buttons">
            <button
              class="btn btn-success"
              id="startSpinBtn"
              onclick="startSpin()"
            >
              –ó–∞–ø—É—Å—Ç–∏—Ç–∏
            </button>
          </div>

          <div
            class="control-group"
            style="display: flex; gap: 10px; align-items: center"
          >
            <div class="label-container">
              winSector:
              <select id="winningSector">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
              </select>
            </div>
            <button
              class="btn btn-primary"
              id="setWinningSectorBtn"
              onclick="setWinningSector()"
            >
              –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏
            </button>
          </div>
        </div>

        <div class="iframe-wrapper">
          <iframe id="widgetFrame" src=""></iframe>
        </div>
      </div>

      <div class="log-section">
        <div class="control-group">
          <div class="label-container">
            Post messages
            <button class="btn btn-secondary" onclick="clearLog()">
              –û—á–∏—Å—Ç–∏—Ç–∏
            </button>
          </div>
        </div>
        <div class="log" id="messageLog"></div>
      </div>
    </div>

    <script>
      // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
      let currentParams = {
        project: '',
        style: '',
        sectors:
          '500 USD; 5,000 USD; 10 FS; 20 FS; 35 FS; 25 USD; 100 USD; 250 USD',
        sectors_type:
          'Bonus Prize; Bonus Prize; Free Spins; Free Spins; Free Spins; Bonus Prize; Bonus Prize; Bonus Prize',
        active: true,
        fps: false,
        vip_level: 0,
      }

      let widgetReady = false
      let isSpinning = false
      let winningSectorSet = false
      let iframe = document.getElementById('widgetFrame')
      const messageLog = document.getElementById('messageLog')
      const startSpinBtn = document.getElementById('startSpinBtn')
      const setWinningSectorBtn = document.getElementById('setWinningSectorBtn')

      function disableStartButton() {
        startSpinBtn.disabled = true
        isSpinning = true
        updateButtonsState()
      }

      function disableSectorButton() {
        setWinningSectorBtn.disabled = true
        winningSectorSet = true
      }

      function enableButtons() {
        startSpinBtn.disabled = false
        setWinningSectorBtn.disabled = false
        isSpinning = false
        winningSectorSet = false
        updateButtonsState()
      }

      function initializeContentEditable() {
        const contentEditableElements = document.querySelectorAll(
          '.contenteditable-textarea'
        )

        contentEditableElements.forEach(element => {
          if (element.id === 'sectors') {
            element.textContent =
              '500 USD; 5,000 USD; 10 FS; 20 FS; 35 FS; 25 USD; 100 USD; 250 USD'
          } else if (element.id === 'sectorsType') {
            element.textContent =
              'Bonus Prize; Bonus Prize; Free Spins; Free Spins; Free Spins; Bonus Prize; Bonus Prize; Bonus Prize'
          }

          element.addEventListener('paste', e => {
            e.preventDefault()
            const text = e.clipboardData.getData('text/plain')
            document.execCommand('insertText', false, text)
          })
        })
      }

      function updateButtonsState() {
        const isActive = currentParams.active
        const winningSectorSelect = document.getElementById('winningSector')
        const themeSelect = document.getElementById('themeSelect')
        const sectorsInput = document.getElementById('sectors')
        const sectorsTypeInput = document.getElementById('sectorsType')
        const customUrlInput = document.getElementById('customUrl')
        const activeCheckbox = document.getElementById('activeCheckbox')
        const fpsCheckbox = document.getElementById('fpsCheckbox')
        const vipLevelInput = document.getElementById('vipLevel')
        const clearLogBtn = document.querySelector(
          'button[onclick="clearLog()"]'
        )
        const applyCustomUrlBtn = document.querySelector(
          'button[onclick="applyCustomUrl()"]'
        )
        const widgetUrlElement = document.getElementById('widgetUrl')

        const isBlocked = isSpinning || !isActive

        startSpinBtn.disabled = !isActive || isSpinning
        setWinningSectorBtn.disabled =
          !isActive || !isSpinning || winningSectorSet
        winningSectorSelect.disabled =
          !isActive || !isSpinning || winningSectorSet
        themeSelect.disabled = isBlocked
        sectorsInput.contentEditable = !isBlocked
        sectorsTypeInput.contentEditable = !isBlocked
        if (customUrlInput) customUrlInput.contentEditable = !isBlocked
        activeCheckbox.disabled = isSpinning
        if (fpsCheckbox) fpsCheckbox.disabled = isSpinning
        if (vipLevelInput) vipLevelInput.disabled = isSpinning

        if (sectorsInput) {
          sectorsInput.classList.toggle('spinning', isSpinning)
        }
        if (sectorsTypeInput) {
          sectorsTypeInput.classList.toggle('spinning', isSpinning)
        }
        if (customUrlInput) {
          customUrlInput.classList.toggle('spinning', isSpinning)
        }

        if (widgetUrlElement) {
          widgetUrlElement.classList.toggle('spinning', isSpinning)
        }

        if (themeSelect) {
          themeSelect.classList.toggle('spinning', isSpinning)
        }

        if (clearLogBtn) clearLogBtn.disabled = isSpinning || !isActive
        if (applyCustomUrlBtn) applyCustomUrlBtn.disabled = isSpinning
      }

      function setTheme(themeIndex) {
        currentParams.style = themeIndex
        updateWidget()
      }

      function applyCustomUrl() {
        const textarea = document.getElementById('customUrl')
        let customUrl = textarea ? textarea.textContent.trim() : ''

        if (customUrl) {
          customUrl = customUrl.replace(/¬ß/g, '&')

          const url = new URL(customUrl)

          currentParams.project = url.searchParams.get('project') || ''
          currentParams.style = url.searchParams.get('style') || ''
          currentParams.sectors = url.searchParams.get('sectors') || ''
          currentParams.sectors_type =
            url.searchParams.get('sectors_type') || ''
          currentParams.active = url.searchParams.get('active') !== 'false'
          currentParams.fps = url.searchParams.get('fps') === 'true'
          currentParams.vip_level = parseInt(
            url.searchParams.get('vip_level') || '0'
          )

          updateFormFields()
          widgetReady = false
          updateWidget()
        }
      }

      function updateFormFields() {
        const projectSelect = document.getElementById('projectSelect')
        const themeSelect = document.getElementById('themeSelect')
        const sectorsElement = document.getElementById('sectors')
        const sectorsTypeElement = document.getElementById('sectorsType')
        const activeCheckbox = document.getElementById('activeCheckbox')
        const fpsCheckbox = document.getElementById('fpsCheckbox')
        const vipLevelInput = document.getElementById('vipLevel')

        if (projectSelect) {
          projectSelect.value = currentParams.project || ''
        }
        if (themeSelect) {
          themeSelect.value = currentParams.style || ''
        }
        if (sectorsElement) {
          sectorsElement.textContent = currentParams.sectors
        }
        if (sectorsTypeElement) {
          sectorsTypeElement.textContent = currentParams.sectors_type
        }
        if (activeCheckbox) {
          activeCheckbox.checked = currentParams.active
        }
        if (fpsCheckbox) {
          fpsCheckbox.checked = currentParams.fps
        }
        if (vipLevelInput) {
          vipLevelInput.value = currentParams.vip_level
        }
      }

      function updateWidget() {
        const url = new URL('./index.html', window.location.href)

        // –î–æ–¥–∞—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
        Object.entries(currentParams).forEach(([key, value]) => {
          if (value !== undefined && value !== null && value !== '') {
            url.searchParams.set(key, value)
          }
        })

        const finalUrl = url.toString()

        // –û–Ω–æ–≤–ª—é—î–º–æ URL —Ç–∞ iframe
        document.getElementById('widgetUrl').textContent = finalUrl
        iframe.src = finalUrl
      }

      function updateParams() {
        const projectSelect = document.getElementById('projectSelect')
        const themeSelect = document.getElementById('themeSelect')
        const sectorsElement = document.getElementById('sectors')
        const sectorsTypeElement = document.getElementById('sectorsType')
        const activeCheckbox = document.getElementById('activeCheckbox')
        const fpsCheckbox = document.getElementById('fpsCheckbox')
        const vipLevelInput = document.getElementById('vipLevel')

        currentParams.project = projectSelect ? projectSelect.value : ''
        currentParams.style = themeSelect ? themeSelect.value : ''
        currentParams.sectors = sectorsElement ? sectorsElement.textContent : ''
        currentParams.sectors_type = sectorsTypeElement
          ? sectorsTypeElement.textContent
          : ''
        currentParams.active = activeCheckbox ? activeCheckbox.checked : true
        currentParams.fps = fpsCheckbox ? fpsCheckbox.checked : false
        currentParams.vip_level = vipLevelInput
          ? parseInt(vipLevelInput.value) || 0
          : 0

        updateWidget()
      }

      // –°–ª—É—Ö–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –≤–∏–¥–∂–µ—Ç–∞
      window.addEventListener('message', event => {
        if (!event.data || typeof event.data !== 'object') return

        switch (event.data.type) {
          case 'lootboxReady':
            widgetReady = true
            logMessage('üì§ lootboxReady', 'received', 'WIDGET')
            updateButtonsState()
            break

          case 'spinEnd':
            logMessage(
              `üì§ spinEnd: ${event.data.data.prize}`,
              'received',
              'WIDGET'
            )
            enableButtons()
            updateButtonsState()
            break
        }
      })

      function startSpin() {
        if (isSpinning) {
          return
        }

        disableStartButton()
        const message = { type: 'startSpin' }
        iframe.contentWindow.postMessage(message, '*')
        logMessage('üì• startSpin', 'sent', 'PARENT')
      }

      function setWinningSector() {
        const select = document.getElementById('winningSector')
        const selectedValue = select.value

        const winningSector = parseInt(selectedValue)
        const sectors = currentParams.sectors.split(';').map(s => s.trim())
        const sectorName =
          sectors[winningSector] || `–°–µ–∫—Ç–æ—Ä ${winningSector + 1}`

        const message = {
          type: 'winSector',
          data: winningSector,
        }

        iframe.contentWindow.postMessage(message, '*')
        logMessage(`üì• winSector: ${winningSector}`, 'sent', 'PARENT')

        winningSectorSet = true
        setWinningSectorBtn.disabled = true
        updateButtonsState()
      }

      function logMessage(message, type = 'info', sender = '') {
        const entry = document.createElement('div')
        entry.className = `log-entry log-${type}`
        const senderPrefix = sender ? `[${sender}] ` : ''
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${senderPrefix}${message}`
        messageLog.appendChild(entry)
        messageLog.scrollTop = messageLog.scrollHeight
      }

      function copyWidgetUrl() {
        const urlDisplay = document.getElementById('widgetUrl')
        const customUrlField = document.getElementById('customUrl')
        const url = urlDisplay.textContent.trim()

        navigator.clipboard.writeText(url).then(() => {
          customUrlField.textContent = url
        })
      }

      function clearLog() {
        messageLog.innerHTML = ''
      }

      /**
       * –§—ñ–ª—å—Ç—Ä—É—î —Ç–µ–º–∏ –≤ —Å–µ–ª–µ–∫—Ç—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É.
       * –Ø–∫—â–æ –ø—Ä–æ–µ–∫—Ç –Ω–µ –≤–∏–±—Ä–∞–Ω–æ ‚Äî –ø–æ–∫–∞–∑—É—î –≤—Å—ñ —Ç–µ–º–∏.
       * –Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ –ø—Ä–æ–µ–∫—Ç ‚Äî –ø–æ–∫–∞–∑—É—î —Ç—ñ–ª—å–∫–∏ —Ç–µ–º–∏ —Ü—å–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É.
       */
      function filterThemesByProject() {
        const projectSelect = document.getElementById('projectSelect')
        const themeSelect = document.getElementById('themeSelect')
        const themeWarning = document.getElementById('themeWarning')
        const selectedProject = projectSelect.value
        const options = themeSelect.querySelectorAll('option[data-project]')

        options.forEach(option => {
          const themeProject = option.getAttribute('data-project')

          if (!selectedProject) {
            // –ü—Ä–æ–µ–∫—Ç –Ω–µ –≤–∏–±—Ä–∞–Ω–æ ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –≤—Å—ñ —Ç–µ–º–∏
            option.style.display = ''
            option.disabled = false
          } else if (themeProject === selectedProject) {
            // –¢–µ–º–∞ –Ω–∞–ª–µ–∂–∏—Ç—å –≤–∏–±—Ä–∞–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ
            option.style.display = ''
            option.disabled = false
          } else {
            // –¢–µ–º–∞ –Ω–µ –Ω–∞–ª–µ–∂–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—É ‚Äî —Ö–æ–≤–∞—î–º–æ
            option.style.display = 'none'
            option.disabled = true
          }
        })

        // –Ø–∫—â–æ –ø–æ—Ç–æ—á–Ω–∞ –≤–∏–±—Ä–∞–Ω–∞ —Ç–µ–º–∞ –Ω–µ –Ω–∞–ª–µ–∂–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—É ‚Äî —Å–∫–∏–¥–∞—î–º–æ –Ω–∞ –¥–µ—Ñ–æ–ª—Ç
        const currentThemeOption = themeSelect.selectedOptions[0]
        if (currentThemeOption && currentThemeOption.disabled) {
          themeSelect.value = ''
        }

        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è —è–∫—â–æ —î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç
        updateThemeWarning()
      }

      /**
       * –ü–æ–∫–∞–∑—É—î/—Ö–æ–≤–∞—î –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Ç–µ–º–∏ –ø—Ä–æ–µ–∫—Ç—É
       */
      function updateThemeWarning() {
        const projectSelect = document.getElementById('projectSelect')
        const themeSelect = document.getElementById('themeSelect')
        const themeWarning = document.getElementById('themeWarning')

        const selectedProject = projectSelect.value
        const selectedTheme = themeSelect.value
        const themeOption = themeSelect.querySelector(
          `option[value="${selectedTheme}"]`
        )

        if (selectedProject && selectedTheme && themeOption) {
          const themeProject = themeOption.getAttribute('data-project')
          if (themeProject && themeProject !== selectedProject) {
            themeWarning.style.display = 'block'
            return
          }
        }

        themeWarning.style.display = 'none'
      }

      document.getElementById('sectors').addEventListener('input', updateParams)
      document
        .getElementById('sectorsType')
        .addEventListener('input', updateParams)
      document
        .getElementById('activeCheckbox')
        .addEventListener('change', updateParams)
      document
        .getElementById('fpsCheckbox')
        .addEventListener('change', updateParams)
      document
        .getElementById('vipLevel')
        .addEventListener('input', updateParams)
      document
        .getElementById('projectSelect')
        .addEventListener('change', function () {
          filterThemesByProject()
          updateParams()
        })
      document
        .getElementById('themeSelect')
        .addEventListener('change', function () {
          updateThemeWarning()
          updateParams()
        })

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
      filterThemesByProject()
      updateWidget()
      updateButtonsState()
      initializeContentEditable()
    </script>
  </body>
</html>
